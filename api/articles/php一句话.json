{"title":"php 网站中的一句话木马识别与防范","uid":"c7ee17cc8146e12609fe83b103aa69f4","slug":"php一句话","date":"2022-03-14T00:37:57.000Z","updated":"2022-03-14T01:22:33.005Z","comments":true,"path":"api/articles/php一句话.json","keywords":null,"cover":null,"content":"<h1 id=\"PHP-网站中的一句话木马\"><a href=\"#PHP-网站中的一句话木马\" class=\"headerlink\" title=\"PHP 网站中的一句话木马\"></a>PHP 网站中的一句话木马</h1><h1 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理:\"></a>原理:</h1><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php @<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>$_POST <span class=\"token punctuation\">[</span>‘pass’<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>在 PHP 中 eval 函数 把字符串按照 PHP 代码来计算，@ 表示停止报错，pass 为 一句话木马连接器的访问密码，以 POST 方式进行传参，</p>\n<hr>\n<h2 id=\"一句话木马写入数据库-x2F-网页文件的方式\"><a href=\"#一句话木马写入数据库-x2F-网页文件的方式\" class=\"headerlink\" title=\"一句话木马写入数据库&#x2F;网页文件的方式:\"></a>一句话木马写入数据库&#x2F;网页文件的方式:</h2><p>通过sql注入软件或语句,直接在数据库内<strong>写入php木马</strong></p>\n<h2 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传:\"></a>文件上传:</h2><p>已知:文件名从右往左,符合则上传<br>未知:文件名从左往右,漏洞上传(构造图片马)</p>\n<hr>\n<h1 id=\"对抗措施\"><a href=\"#对抗措施\" class=\"headerlink\" title=\"对抗措施\"></a>对抗措施</h1><h2 id=\"查找与清理网站中的木马\"><a href=\"#查找与清理网站中的木马\" class=\"headerlink\" title=\"查找与清理网站中的木马\"></a>查找与清理网站中的木马</h2><h3 id=\"0x01找到一句话木马的绝对路径并删除\"><a href=\"#0x01找到一句话木马的绝对路径并删除\" class=\"headerlink\" title=\"0x01找到一句话木马的绝对路径并删除\"></a>0x01找到一句话木马的绝对路径并删除</h3><h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux:\"></a>linux:</h4><p> grep 命令来搜索关键字“eval、system” 等来字段遍历.</p>\n<h4 id=\"web日志\"><a href=\"#web日志\" class=\"headerlink\" title=\"web日志:\"></a>web日志:</h4><p>在日志中搜索用来注入的字符， 如 select、and 等等</p>\n<h4 id=\"waf和安全狗\"><a href=\"#waf和安全狗\" class=\"headerlink\" title=\"waf和安全狗:\"></a>waf和安全狗:</h4><p>D盾扫描</p>\n<h3 id=\"0x02创建查杀进程\"><a href=\"#0x02创建查杀进程\" class=\"headerlink\" title=\"0x02创建查杀进程\"></a>0x02创建查杀进程</h3><p>网站目录下创建一个</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kii -9 -1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>的PHP文件并访问杀掉当前运行的所有进程.</p>\n<hr>\n<h1 id=\"防范措施\"><a href=\"#防范措施\" class=\"headerlink\" title=\"防范措施\"></a>防范措施</h1><h2 id=\"发现与防护\"><a href=\"#发现与防护\" class=\"headerlink\" title=\"发现与防护\"></a>发现与防护</h2><p>更改普通用户执行权限、漏扫工具专业版、对CMS的代码进行审计、渗透测试模拟攻击</p>\n<h2 id=\"修改数据库默认端口\"><a href=\"#修改数据库默认端口\" class=\"headerlink\" title=\"修改数据库默认端口\"></a>修改数据库默认端口</h2><p>在数据库连接文件中加入容错代码,防止爆库</p>\n<h2 id=\"数据过滤\"><a href=\"#数据过滤\" class=\"headerlink\" title=\"数据过滤\"></a>数据过滤</h2><p>对用户的输入进行过滤</p>\n","feature":true,"text":"PHP 网站中的一句话木马原理:&lt;?php @eval($_POST [‘pass’]);?> 在 PHP 中 eval 函数 把字符串按照 PHP 代码来计算，@ 表示停止报错，pass 为 一句话木马连接器的访问密码，以 POST 方式进行传参， 一句话木马写入数据库&...","link":"","photos":[],"count_time":{"symbolsCount":524,"symbolsTime":"1 mins."},"categories":[{"name":"技术","slug":"技术","count":3,"path":"api/categories/技术.json"}],"tags":[{"name":"学习笔记","slug":"学习笔记","count":4,"path":"api/tags/学习笔记.json"},{"name":"php","slug":"php","count":1,"path":"api/tags/php.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#PHP-%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC\"><span class=\"toc-text\">PHP 网站中的一句话木马</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理:</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93-x2F-%E7%BD%91%E9%A1%B5%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">一句话木马写入数据库&#x2F;网页文件的方式:</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">文件上传:</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%8A%97%E6%8E%AA%E6%96%BD\"><span class=\"toc-text\">对抗措施</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E6%89%BE%E4%B8%8E%E6%B8%85%E7%90%86%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84%E6%9C%A8%E9%A9%AC\"><span class=\"toc-text\">查找与清理网站中的木马</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01%E6%89%BE%E5%88%B0%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%B9%B6%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">0x01找到一句话木马的绝对路径并删除</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#linux\"><span class=\"toc-text\">linux:</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#web%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">web日志:</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#waf%E5%92%8C%E5%AE%89%E5%85%A8%E7%8B%97\"><span class=\"toc-text\">waf和安全狗:</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02%E5%88%9B%E5%BB%BA%E6%9F%A5%E6%9D%80%E8%BF%9B%E7%A8%8B\"><span class=\"toc-text\">0x02创建查杀进程</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD\"><span class=\"toc-text\">防范措施</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%91%E7%8E%B0%E4%B8%8E%E9%98%B2%E6%8A%A4\"><span class=\"toc-text\">发现与防护</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3\"><span class=\"toc-text\">修改数据库默认端口</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">数据过滤</span></a></li></ol></li></ol>","author":{"name":"wjl110","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/53851034?s=400&u=d3e4276dbc73f46c11ffa447d9d9d0803c5274ea&v=4","link":"/","description":"学而不思则罔,思而不学则怠<br /> @ <b>公众号：爱日推</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"反弹shell命令学习笔记","uid":"e54765d52f8094054e22b090d91f01da","slug":"反弹shell","date":"2022-03-15T09:20:06.000Z","updated":"2022-03-15T12:31:35.303Z","comments":true,"path":"api/articles/反弹shell.json","keywords":null,"cover":[],"text":"文章目录 前言 为何给靶机发送这条执行命令就会自动连接到本地计算机,并且出发实时通讯机制(ps:有点类似oicq,前生就是用的这种模式开发的即时通讯) 作为渗透测试人员必备技能,反弹shell到底是什么原理,以及如何使用,本文是自己学习shell命令时的个人感悟和笔记,文章内容大...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"技术","slug":"技术","count":3,"path":"api/categories/技术.json"}],"tags":[{"name":"学习笔记","slug":"学习笔记","count":4,"path":"api/tags/学习笔记.json"},{"name":"Mac","slug":"Mac","count":2,"path":"api/tags/Mac.json"},{"name":"shell","slug":"shell","count":1,"path":"api/tags/shell.json"},{"name":"kali-Linux","slug":"kali-Linux","count":1,"path":"api/tags/kali-Linux.json"}],"author":{"name":"wjl110","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/53851034?s=400&u=d3e4276dbc73f46c11ffa447d9d9d0803c5274ea&v=4","link":"/","description":"学而不思则罔,思而不学则怠<br /> @ <b>公众号：爱日推</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"HEXO个人博客实战指南","uid":"445c7ad8fefd50bd2d325cc8b0a0820f","slug":"HEXO个人博客实战指南","date":"2022-03-12T13:19:03.000Z","updated":"2022-03-14T01:19:06.073Z","comments":true,"path":"api/articles/HEXO个人博客实战指南.json","keywords":null,"cover":[],"text":"HEXO个人博客实战指南命令汇总 本地测试:cd Desktop/wjl110.xyz hexo cl &amp; hexo g &amp; hexo -p 54321 server 发布github:hexo cl &amp; hexo g &amp; hexo d 文章标题模...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"笔记","slug":"笔记","count":2,"path":"api/categories/笔记.json"}],"tags":[{"name":"学习笔记","slug":"学习笔记","count":4,"path":"api/tags/学习笔记.json"},{"name":"博客","slug":"博客","count":1,"path":"api/tags/博客.json"}],"author":{"name":"wjl110","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/53851034?s=400&u=d3e4276dbc73f46c11ffa447d9d9d0803c5274ea&v=4","link":"/","description":"学而不思则罔,思而不学则怠<br /> @ <b>公众号：爱日推</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}