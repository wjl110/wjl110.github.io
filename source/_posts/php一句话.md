---
title: php 网站中的一句话木马识别与防范
date: 2022-03-14 08:37:57
tags: 
- 学习笔记
- php
categories:
-  技术
feature: true
---

# PHP 网站中的一句话木马
# 原理:
```javascript
    <?php @eval($_POST [‘pass’]);?>
```
在 PHP 中 eval 函数 把字符串按照 PHP 代码来计算，@ 表示停止报错，pass 为 一句话木马连接器的访问密码，以 POST 方式进行传参，

---
## 一句话木马写入数据库/网页文件的方式:

通过sql注入软件或语句,直接在数据库内**写入php木马**
## 文件上传:
已知:文件名从右往左,符合则上传
未知:文件名从左往右,漏洞上传(构造图片马)

---
# 对抗措施
## 查找与清理网站中的木马
### 0x01找到一句话木马的绝对路径并删除
#### linux:
 grep 命令来搜索关键字“eval、system” 等来字段遍历.
 
#### web日志:
在日志中搜索用来注入的字符， 如 select、and 等等
#### waf和安全狗:
D盾扫描

### 0x02创建查杀进程
网站目录下创建一个

```javascript        
    <?php system("kii -9 -1");?> 
```

的PHP文件并访问杀掉当前运行的所有进程.

---
# 防范措施

## 发现与防护

更改普通用户执行权限、漏扫工具专业版、对CMS的代码进行审计、渗透测试模拟攻击


## 修改数据库默认端口


在数据库连接文件中加入容错代码,防止爆库


## 数据过滤

对用户的输入进行过滤

